generator client {
  provider = "prisma-client"
  output   = "../prisma/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Workspace {
  id             String   @id
  userId         String   @unique
  moduleLayouts  Json?
  pinnedModules  String[] @default([])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  User           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id             String          @id
  name           String
  email          String
  emailVerified  Boolean         @default(false)
  image          String?
  removeBgApiKey String?
  deeplApiKey    String?

  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  
  sessions       Session[]
  accounts       Account[]
  
  //relations
  workspace      Workspace?
  colorPalettes  ColorPalette[]
  domainNames    DomainName[]
  snippets       Snippet[]
  youtubeVideos  YouTubeVideo[]
  pomodoroSettings PomodoroSettings?
  stickyNote     StickyNote?

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model ColorPalette {
  id        String   @id @default(cuid())
  userId    String
  name      String
  colors    Json
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("color_palette")
}

model DomainName {
  id                  String   @id @default(cuid())
  userId              String
  domain              String
  registrar           String
  registrarUrl        String?
  expiresAt           DateTime
  autoRenew           Boolean  @default(false)
  reminderOneMonth    Boolean  @default(true)
  reminderOneWeek     Boolean  @default(true)
  lastReminderSent    DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("domain_name")
}

model Snippet {
  id          String    @id @default(cuid())
  userId      String
  title       String
  description String?
  language    String
  code        String
  tags        String[]  @default([])
  isFavorite  Boolean   @default(false)
  lastUsedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isFavorite])
  @@index([lastUsedAt])
  @@map("snippet")
}

model YouTubeVideo {
  id         String   @id @default(cuid())
  userId     String
  url        String
  title      String
  videoId    String
  playlistId String?
  isPlaylist Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("youtube_video")
}


model PomodoroSettings {
   id                  String   @id @default(cuid())
   userId              String   @unique

   //lengths in minutes
   workDuration        Int      @default(50)
   breakDuration       Int      @default(10)
   cycles              Int      @default(3)

   //predefined sound IDs
   sessionStartSound   String   @default("rythm-bell")
   breakStartSound     String   @default("completed")
   breakEndSound       String   @default("triangle")
   sessionEndSound     String   @default("victory-dance")

   //background customization
   backgroundImage     String?  @default("cyan") // Base64 ou ID image galerie
   backgroundType      String   @default("gallery") // "gallery" | "custom" | "none"
   textColor           String   @default("#FFFFFF")

   //options
   autoStartBreaks     Boolean  @default(false)
   autoStartPomodoros  Boolean  @default(false)
   soundEnabled        Boolean  @default(true)

   createdAt           DateTime @default(now())
   updatedAt           DateTime @updatedAt

   user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

   @@index([userId])
   @@map("pomodoro_settings")
 }

model StickyNote {
  id        String   @id @default(cuid())
  userId    String   @unique
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sticky_note")
}